<script>
    async function geocodeLocation(location) {
        const apiKey = 'cc7e42aa1959905e0f7ba900ebe10566';  // Your API key
        const url = `https://api.openweathermap.org/geo/1.0/direct?q=${location}&limit=1&appid=${apiKey}`;  // Corrected URL

        try {
            console.log("Fetching geocode data for location:", location);  // Added logging
            const response = await fetch(url);
            const data = await response.json();
            
            console.log("Geocode API response:", data);  // Log the response for debugging
            
            if (data.length > 0) {
                const lat = data[0].lat;
                const lon = data[0].lon;
                getWeather(lat, lon);
            } else {
                alert('Location not found');
            }
        } catch (error) {
            console.error('Error fetching geocode data:', error);  // Log the error
            alert('Failed to retrieve location data');
        }
    }

    async function getWeather(lat, lon) {
        const apiKey = 'cc7e42aa1959905e0f7ba900ebe10566';  // Your API key
        const url = `https://api.openweathermap.org/data/3.0/onecall?lat=${lat}&lon=${lon}&exclude=minutely,hourly&units=metric&appid=${apiKey}`;
        
        try {
            console.log("Fetching weather data for coordinates:", lat, lon);  // Added logging
            const response = await fetch(url);
            const data = await response.json();

            console.log("Weather API response:", data);  // Log the response for debugging
            
            if (data) {
                displayWeather(data);
            } else {
                alert('Weather data not found');
            }
        } catch (error) {
            console.error('Error fetching weather data:', error);  // Log the error
            alert('Failed to retrieve weather data');
        }
    }

    function displayWeather(data) {
        const weatherContainer = document.getElementById('weatherResult');
        const current = data.current;
        const daily = data.daily;

        let weatherHTML = `
            <h2>Weather in ${data.timezone}</h2>
            <p>Current Temperature: ${current.temp}°C</p>
            <p>Weather: ${current.weather[0].description}</p>
            <p>Humidity: ${current.humidity}%</p>
            <h3>8-Day Forecast:</h3>
            <ul>
        `;

        daily.forEach(day => {
            const date = new Date(day.dt * 1000).toLocaleDateString();
            weatherHTML += `
                <li>${date} - Temp: ${day.temp.day}°C - Weather: ${day.weather[0].description}</li>
            `;
        });

        weatherHTML += '</ul>';
        weatherContainer.innerHTML = weatherHTML;
    }

    document.getElementById('weatherForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const location = document.getElementById('location').value;
        geocodeLocation(location);
    });
</script>
